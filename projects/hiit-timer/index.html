<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>HIIT Timer</title>
    <meta name="description" content="A timer for HIIT workouts" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Joshua Ji" />
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./assets/simptip.min.css" />
    <link rel="stylesheet" href="./assets/main.css" />
</head>

<body>
    <div id="elm"></div>
    <script src="./assets/howler.core.js"></script>
    <script src="elm.js"></script>
    <script>
        const whistle = new Howl({
            src: ['assets/sounds/whistle.mp3']
        });

        const tada = new Howl({
            src: ['assets/sounds/tada.mp3', 'assets/sounds/tada.wav']
        });

        var storedConfig = localStorage.getItem('config');
        console.log("Retrieved state: ", storedConfig);

        var app = Elm.Main.init({
            node: document.getElementById('elm'),
            flags: {
                windowSize: {
                    height: window.innerHeight,
                    width: window.innerWidth
                },
                storedConfig: JSON.parse(storedConfig)
            }
        });

        app.ports.storeConfig.subscribe(config => {
            let configJson = JSON.stringify(config);
            localStorage.setItem('config', configJson);
            console.log("Saved state: ", configJson);
            app.ports.storeConfigSuccess.send(null)
        });

        app.ports.playWhistle.subscribe(() => {
            whistle.play()
        });

        app.ports.playTada.subscribe(() => {
            tada.play()
        });
    </script>
</body>

</html>